<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Letter Received - Feedback System</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="container">
        <div class="success-icon">‚úÖ</div>
        
        <div class="header">
            <h1>üì¨ Letter Received!</h1>
            <p>Thank you for scanning the QR code. This confirms you've received the letter.</p>
        </div>
        
        <div class="message">
            <h2>üéâ Confirmation Successful</h2>
            <p>A notification will be automatically sent to confirm that you've received and opened this letter. No further action is required from you.</p>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            Sending confirmation email...
        </div>
        
        <div class="status" id="status"></div>
        
        <button class="btn" id="sendConfirmation">üìß Send Confirmation</button>
        <button class="btn btn-secondary" id="manualEmail">‚úâÔ∏è Send Manual Email</button>
        
        <div class="info-section">
            <h3>‚ÑπÔ∏è How this works:</h3>
            <p>
                When you scanned the QR code, it brought you to this page. Clicking the confirmation button will automatically send an email to the letter sender letting them know you've received their message. This is a simple and effective way to get delivery confirmation for physical mail.
            </p>
        </div>
    </div>

    <!-- ‚úÖ Updated script path and wrapped with DOMContentLoaded -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const senderEmail = urlParams.get('sender') || 'sender@example.com';
            const letterID = urlParams.get('id') || 'LETTER-' + Date.now();
            const recipientName = urlParams.get('name') || 'Recipient';
            const letterSubject = urlParams.get('subject') || 'Letter Confirmation';

            const loading = document.getElementById('loading');
            const status = document.getElementById('status');
            const sendBtn = document.getElementById('sendConfirmation');
            const manualBtn = document.getElementById('manualEmail');

            function showStatus(message, type) {
                status.textContent = message;
                status.className = `status ${type}`;
                status.style.display = 'block';

                setTimeout(() => {
                    status.style.display = 'none';
                }, 5000);
            }

            function sendConfirmationEmail() {
                loading.classList.add('active');
                sendBtn.disabled = true;

                setTimeout(() => {
                    loading.classList.remove('active');

                    const currentDate = new Date().toLocaleString();
                    const confirmationSubject = `Letter Received Confirmation - ${letterSubject}`;
                    const confirmationBody = `Hello,

This is an automated confirmation that your letter has been received and read.

Details:
- Letter ID: ${letterID}
- Recipient: ${recipientName}
- Confirmed at: ${currentDate}
- User Agent: ${navigator.userAgent}

The QR code in your letter was scanned successfully, confirming delivery.

This is an automated message from the Letter Feedback System.`;

                    const mailtoLink = `mailto:${senderEmail}?subject=${encodeURIComponent(confirmationSubject)}&body=${encodeURIComponent(confirmationBody)}`;
                    window.location.href = mailtoLink;

                    showStatus('Confirmation email opened in your default email client!', 'success');
                    sendBtn.textContent = '‚úÖ Confirmation Sent';
                    sendBtn.disabled = false;
                }, 2000);
            }

            function sendManualEmail() {
                const subject = `Manual Letter Confirmation - ${letterSubject}`;
                const body = `Hello,

I'm writing to confirm that I received your letter (ID: ${letterID}).

Thank you for including the QR code feedback system - it's a great way to confirm delivery!

Best regards,
${recipientName}`;

                const mailtoLink = `mailto:${senderEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                window.location.href = mailtoLink;

                showStatus('Manual email opened in your default email client!', 'success');
            }

            sendBtn.addEventListener('click', sendConfirmationEmail);
            manualBtn.addEventListener('click', sendManualEmail);

            if (recipientName && recipientName !== 'Recipient') {
                document.querySelector('.header p').textContent = `Thank you ${recipientName} for scanning the QR code. This confirms you've received the letter.`;
            }

            console.log('Letter feedback page loaded', {
                letterID: letterID,
                senderEmail: senderEmail,
                recipientName: recipientName,
                timestamp: new Date().toISOString()
            });
        });
    </script>
</body>
</html>
